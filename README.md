# final-project-DavidMinarsch

## Style guide
This project's solidity code follows:
https://solidity.readthedocs.io/en/develop/style-guide.html

## Setup:
Go to root folder and ensure Node.js version is aligned:
```
nvm install
```
Install all dependencies for contract development:
```
npm install
```
Install all dependencies for client development:
```
cd client && npm install
```

## For development (non-upgradable route):
1) Test contracts for expected behaviour:
```
truffle test
```
2) Compile contracts:
```
truffle compile
```
3) Start a test blockchain (in deterministic mode: so it generates deterministic addresses based on a pre-defined mnemonic) with ganache:
```
ganache-cli --deterministic
```
4) Migrate contracts onto the test blockchain:
```
truffle migrate
```
5) Test dapp:
```
cd client && npm test
```
6) Start the dev-server
```
cd client && npm run start
```
7) Make sure MetaMask points to correct network and has your account loaded.

## For development (upgradable route utilizing Zeppelin-OS)
1) Test contracts for expected behaviour:
```
truffle test
```
2) Compile and add the contracts to zeppelin os project:
```
zos add ProofOfExistence
```
3) Start a test blockchain (in deterministic mode: so it generates deterministic addresses based on a pre-defined mnemonic) with ganache:
```
ganache-cli --deterministic
```
4) Migrate contracts onto the test blockchain :
a) First, create a session (note, the from address MUST be different from the first address generated by ganache!; e.g. take the second one):
```
zos session --network development --from 0xffcf8fdee72ac11b5c542428b35eef5769c409f0 --expires 3600
```
b) Second, create logic contract:
```
zos push
```
c) Third, create first usable instance of ProofOfExistence contract:
```
zos create ProofOfExistence
```
5) Test dapp:
```
cd client && npm test
```
6) Start the dev-server
```
cd client && npm run start
```
7) Make sure MetaMask points to correct network and has your account loaded.

### Adding contracts to Zeppelin:
Adding the contract to zeppelin os project:
```
zos add ProofOfExistence
```
Upgrading:
https://docs.zeppelinos.org/docs/upgrading.html

### Using truffle console:
You can interact with the deployed contracts directly via Truffle console:
```
const account = web3.eth.getAccounts().then(a => {return a[0];})
const poe = await ProofOfExistence.at(ProofOfExistence.address)
const count = await poe.count()
const ids = await poe.getIdsForAddress.call(await web3.eth.getAccounts().then(a => {return a[0];}))
```

### Linting:
You can run a linting script (first make `lint_all` executable: `chmod +x lint_all`) which runs the common linters:
```
./lint_all

```
More linters (some with issues due to React/Zos setup):
```
myth -x contracts/ProofOfExistence.sol
myth --truffle
slither contracts/ProofOfExistence.sol
```

## For production:
Build for production:
```
cd client && npm run build
```

### Deployment to IPFS

1. Change environment variable to `production`

2. Check webpack to make sure all compression settings are correct

3. Run
```
$ ipfs daemon
# and
$ ipfs add -r public
```


Access mobile cam from web app:
https://stackoverflow.com/questions/8581081/how-to-access-a-mobiles-camera-from-a-web-app
https://www.html5rocks.com/en/tutorials/getusermedia/intro/
https://www.smashingmagazine.com/2018/04/audio-video-recording-react-native-expo/
